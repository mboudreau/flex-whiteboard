<?xml version="1.0"?>
<mx:FlexNativeMenu xmlns:fx="http://ns.adobe.com/mxml/2009"
                   xmlns:s="library://ns.adobe.com/flex/spark"
                   xmlns:mx="library://ns.adobe.com/flex/mx"
                   xmlns:parsley="http://www.spicefactory.org/parsley">

    <fx:Script><![CDATA[
        import mx.core.Application;
        import mx.core.FlexGlobals;
        import mx.events.FlexNativeMenuEvent;
        import mx.resources.ResourceManager;

        import org.apache.flex.utilities.developerToolSuite.infrastructure.message.MenuActionMessage;
        import org.apache.flex.utilities.developerToolSuite.presentation.behavior.menu.IApplicationMenuPM;

        import spark.components.WindowedApplication;

        [Inject]
        public var model:IApplicationMenuPM;

        [MessageDispatcher]
        public var dispatch:Function;

        [Init]
        public function init():void {

            showRoot = false;
            labelFunction = model.getMenuItemLabel;
            dataProvider = model.dataProvider;
            addEventListener(FlexNativeMenuEvent.ITEM_CLICK, menu_itemClickHandler);
            ResourceManager.getInstance().addEventListener(Event.CHANGE, localeChangeHandler);
        }

        private function menu_itemClickHandler(event:FlexNativeMenuEvent):void {
            dispatch(new MenuActionMessage(event.item));
        }

        private function localeChangeHandler(event:Event):void {
            dataProvider = model.dataProvider;
        }
        ]]></fx:Script>
</mx:FlexNativeMenu>
